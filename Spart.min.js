function Spart(b){if("function"!==typeof b)throw"Invalid onNeighbour callback passed";this.objects=[];this.gridSize=[0,0];this.onNeighbour=b}Spart.prototype.add=function(b,a,c){this.gridSize[0]<a&&(this.gridSize[0]=a);this.gridSize[1]<c&&(this.gridSize[1]=c);this.objects.push(b)};Spart.prototype._neighbours=function(b,a){for(var c=a.length;c--;)this.onNeighbour(b,a[c])};
Spart.prototype.check=function(){var b=this.objects.length;for(this.bounds=[Infinity,Infinity,-Infinity,-Infinity];b--;){var a=this.objects[b].coords;this.bounds[0]>a.x&&(this.bounds[0]=a.x);this.bounds[1]>a.y&&(this.bounds[1]=a.y);this.bounds[2]<a.x&&(this.bounds[2]=a.x);this.bounds[3]<a.y&&(this.bounds[3]=a.y)}a=this.bounds[2]-this.bounds[0];var c=this.bounds[3]-this.bounds[1];if(a<2*this.gridSize[0]&&c<2*this.gridSize[1])for(b=this.objects.length;b--;){var d=this.objects[b];for(a=b;a--;)this.onNeighbour(d,
this.objects[a])}else{b=Math.ceil(a/this.gridSize[0]);d=Math.ceil(c/this.gridSize[1]);0===a%this.gridSize[0]&&b++;0===c%this.gridSize[0]&&d++;for(this.grid=[];b--;)for(this.grid[b]=[],a=d;a--;)this.grid[b][a]=[];for(b=this.objects.length;b--;)d=this.objects[b],this.grid[Math.floor((d.coords.x-this.bounds[0])/this.gridSize[0])][Math.floor((d.coords.y-this.bounds[1])/this.gridSize[1])].push(d);for(b=this.grid.length;b--;){c=this.grid[b];var k=b!==this.grid.length-1;for(a=c.length;a--;)for(var f=c[a],
g=f.length,h=a!==c.length-1,l=0!==a;g--;){d=f[g];for(var e=g;e--;)this.onNeighbour(d,f[e]);k&&(e=this.grid[b+1],l&&this._neighbours(d,e[a-1]),this._neighbours(d,e[a]),h&&this._neighbours(d,e[a+1]));h&&this._neighbours(d,c[a+1])}}}};
